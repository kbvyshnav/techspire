
{% extends "User/userbaseUI.html" %}
{% block body %}
{% load static%}
<style>



.exit-symbol {
 position: sticky;
 top: 0px;
 left: 100%;
 font-size: 35px;
 cursor: pointer;
  
}


.btn {
    appearance: none;
      -webkit-appearance: none;
    font-family: sans-serif;
    cursor: pointer;
    padding: 12px;
    min-width: 100px;
    border: 0px;
      -webkit-transition: background-color 100ms linear;
      -ms-transition: background-color 100ms linear;
       transition: background-color 100ms linear;
    float: left;
  }
.edit {
  background: #1181dd;
  margin-right: 60px;
  color: #ffffff;
}
.delete {
  background: #e20b0b;
  
  color: #ffffff;
}
.edit:hover {
  background: #069ff8;
  color: #ffffff;
}
  .view {
  text-decoration: none;
  position: relative;
  border: none;
  font-size: 14px;
  font-family: inherit;
  color: #fff;
  width: 5em;
  height: 2em;
  line-height: 2em;
  text-align: center;
  background: linear-gradient(90deg,#03a9f4,#f441a5,#ffeb3b,#03a9f4);
  background-size: 300%;
  border-radius: 30px;
  z-index: 1;
}

.view:hover {
  animation: ani 8s linear infinite;
  border: none;
}

@keyframes ani {
  0% {
    background-position: 0%;
  }

  100% {
    background-position: 400%;
  }
}

.box {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: #fff;
display: none;
border-radius: 20px;
box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
padding: 20px;
width: 1000px;
height: 500px;
z-index: 9999;
}

.box .child {
  display: none;
}

.view:before {
  content: '';
  position: absolute;
  top: -5px;
  left: -5px;
  right: -5px;
  bottom: -5px;
  z-index: -1;
  background: linear-gradient(90deg,#03a9f4,#f441a5,#ffeb3b,#03a9f4);
  background-size: 400%;
  border-radius: 35px;
  transition: 1s;
  
}

.view:hover::before {
  filter: blur(20px);
}

.view:active {
  background: linear-gradient(32deg,#03a9f4,#f441a5,#ffeb3b,#03a9f4);
}
  #open {
    display: inline-block;
  border-radius: 20px;
  background-color: #7948d4;
  font-weight: bold;
  color: #ffffff;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  font-size: 16px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}


#assigndev {
  text-align: center; /* Center-align the contents of the <p> element */
}

#assigndev button {
  /* Style for the oval-shaped button */
  background-color: #1181dd; /* Blue color */
  color: #ffffff;
  padding: 5px 20px; /* Adjust padding for oval shape */
  text-align: center;
  text-decoration: none;
  font-size: 16px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-block; /* Ensure the button is not displayed as a block element */
  border-radius:10px;
  box-shadow:3px 3px 3px 1px grey;
}

#rejectdev {
  text-align: center; /* Center-align the contents of the <p> element */
  
}

#rejectdev button {
  /* Style for the oval-shaped button */
  background-color: red; /* Blue color */
  color: #ffffff;
  padding: 5px 20px; /* Adjust padding for oval shape */
  text-align: center;
  text-decoration: none;
  font-size: 16px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-block; /* Ensure the button is not displayed as a block element */
 border-radius:10px;
  box-shadow:3px 3px 3px 1px grey;
}

#todo{
  float:right;
  position:relative;
  bottom:10%;

}


    </style>
 
<ul class="box-info">

    <a href="{% url 'user_home' %}">
	<li>
		<i class='bx bxs-calendar-check' ></i>
		<span class="text">
			<h3 id="Requests">{{tickets.count}}</h3>
			<p>Inbox</p>
		</span></a>
	</li>
  <a href="{% url 'user_inprogress' %}">
	<li>
		<i class='bx bx-hourglass'></i>
		<span class="text">
			<h3 id="Pending" >{{forwarded}}</h3>
			<p>Forwarded</p>
		</span>
	</li></a>
	<li><i class='bx bx-window-close'></i>
		<span class="text">
			<h3 id="Closed">{{closed}}</h3>
			<p>Closed</p>
		</span>
	</li>
</ul>

<div class="table-data">
  <div class="order">
      <div class="head">
        <h3>Tickets 
<p style="color:red ; display: inline;" >INBOX</p></h3>
          <i class='bx bx-search' ></i>
          <i class='bx bx-filter' ></i>
      </div>
       <table id="table-datas">
          <thead>
              <tr>

                  <th>Ticket ID</th>
                  <th>Issue</th>
                  <th>Date Of Issue</th>
                  <!-- <th>Date Of Expiry</th> -->
                  
                  <th>View Ticket</th>  
              </tr>
          </thead>
      
      <tbody> 
        {% for ticket in tickets %}
        <tr><td>{{ticket.ticket_no}}</td>
        <td>{{ticket.subject}}</td>
        <td>{{ticket.issued_on}}</td>
        <td><button type="button" class="view" data-ticket="{{ ticket.ticket_no }}"  id="{{ticket.ticket_no}}" onclick="actionselect('{{ticket.ticket_no}}') " > View</button></td>
        <td><input type="Hidden" id = 'tdes{{ticket.ticket_no}}' value="{{ticket.desc}}">
        <input type="Hidden" id = 'tsub{{ticket.ticket_no}}' value="{{ticket.subject}}">
        <input type="Hidden" id = 'tfile{{ticket.ticket_no}}' value="{{ticket.file.url}}">
        <input type="Hidden" id = 'tpriority{{ticket.ticket_no}}' value="{{ticket.priority}}">
        <input type="hidden" id = 'tstatus{{ticket.ticket_no}}' value="{{ticket.status}}"></td>
        
    
      {% endfor %}
      <input type="Hidden" id = 'updtid' value="">
      
    </tr>
  </tbody>
    </table></div>
    <div class="box" name="tcktpopup" id="tcktpopup" style="overflow-y: auto;">
      <div>
        <span class="exit-symbol" onclick="closeBox()">&times;</span>
         <p style="color:rgb(63, 109, 238); font-size:1.3rem;"><b>Ticket Details</b></p>
         <table>
          <body>
                <br>
                <tr class="exclude-hover"><td width = 180><b>Ticket id</b></td><td id="ticket_no" width = 300>:</td></tr>
                <tr class="exclude-hover"><td><b>subject</b></td><td id="tsub"></td></tr>
                <tr class="exclude-hover"><td><b>File </b></td><a><td id="tfile"></a></td></tr>
                <tr class="exclude-hover"><td><b>Priority</b></td><td id="tpri"></td></tr>
                <tr class="exclude-hover" style="border-bottom: 2px solid black;"><td><b>Description</b></td>
                  <td><textarea input type="text" disabled id="tdesc" rows="5" cols="80" 
                    style="border:none; color:#342E37; background-color:white; font-family:poppins,sans-serif; font-size:16px; " ></textarea></td></tr>
                
              </body></table> <hr>
              </div>

            


                <div id = 'tstr_slct' class="child."> <!-- for status : PP -->
                  <!-- After Test completetion tester forwarded to admin to Accept -->
                  <table>
                  <tr class="exclude-hover" >
                      <td>
                        <!-- Function : uatclifwd() 
                        usage : To forward ticket to client for testing
                        -->
                       

                          <button type="button"  id = 'tstr_btn' onclick="usrops()"> Forward to client</button> 
                      </td>
                  </tr>
                  </table>

                </div>           





                <!-- mark-->
              <!--<div id = 'tstrasgn' class="child">--> <!-- for status : PP -->
                <!-- After Test completetion tester forwarded to admin to Accept Also used for
                Assign tester when Status : EH-->
                <!-- <table>
                <tr class="exclude-hover" >
                    <td> -->
                      <!-- Function : tstrutils() 
                      usage : Tester related function are combined to one.
                      -->
                        <!-- <button type="button" onclick="tstrutils()"> Forward to client</button> 
                    </td>
                </tr>
                </table>

              </div> -->




                  <!-- <button type="button"  onclick="chatwindow()">Reject</button></td> -->
                
              
              </div>






{% if messages %}
    {% for message in messages %}
        <script>
            alert("{{ message }}");
        </script>
    {% endfor %}
   
{% endif %}


{% block script %}

<script>
 document.getElementById('dashboard').classList.add('active');

function actionselect(tno,b){
    var tstat = 'tstatus'+ tno;
    document.getElementById('updtid').value = tno;
    var status = document.getElementById(tstat).value.trim();
    // var ttester = document.getElementById('ttester'+tno).value.trim();
    // alert(status);
    if(status == 'PA'){
      var v = showticket(tno,b);
      document.getElementById('tstr_btn').textContent = 'Proceed to live';
    }
}

function usrops(){ // tester related operations
  tno = document.getElementById('updtid').value;
  
  var status = document.getElementById('tstatus'+tno).value.trim();
  // var tester = document.getElementById('tstr_drpdwn').value;

    const link = '/user/usr_ops/' + tno + '/' + status + '/' ;
    window.location.href = link
  
}

function showticket(tno,user){


  // alert(tdesc);
    document.getElementById("tcktpopup").style.display = "block";
  // document.getElementById("devasgn").style.display = "none";

  // $('#myBox').show();
  var tdesc = 'tdes'+ tno;
  var tsub = 'tsub'+tno; // subject
  var tpriority = 'tpriority'+tno; //priority
  var tcl = 'tcli' + tno; //Client
  var tfile = 'tfile' + tno;

  // document.getElementById("myBox").style.display="block";

  // alert(tdesc);

    document.getElementById('ticket_no').innerHTML=":  " + tno; // ticket number

  document.getElementById('tsub').innerHTML=":  " + document.getElementById(tsub).value; // ticket subject
  document.getElementById('tdesc').innerHTML= ":  " + document.getElementById(tdesc).value; // ticket description
  // alert(document.getElementById(tdesc).value);
  var fileurl = document.getElementById(tfile).value;
  var link =document.createElement('a'); 
  link.href = fileurl;
  link.target = '_blank';
  link.textContent = ': Click here to view file';
  // alert(link);
  document.getElementById('tfile').appendChild(link);
  document.getElementById('tpri').innerHTML=":  " + document.getElementById(tpriority).value; // ticket priority

  }




















//     $(document).ready(function() {
//     // Define the Ajax function
//     function updateCount() {
//         $.ajax({
//             url: "% url 'Get_Ticket_Count' id=LoggedUser.id %}",
//             type: 'GET',
//             dataType: 'json',
//             success: function(response) {
              
//               console.log(response);
//         var data = response.data;
//         for(var i=0; i<data.length; i++){
//             console.log(data[i].status, data[i].count);
//             if (data[i].status =='PENDING' ){
//             $('#Requests').html(data[i].count);}
//             if(data[i].status== 'IN PROGRESS'){
//             $('#Pending').html(data[i].count);}
            
//             if(data[i] == 'CLOSED'){
//             $('#Closed').html(data[i].count);}
           

//         }
                
//             }
//         });
//     }

//     // Call the function on page load and every 10 seconds
//     updateCount();
//     // setInterval(updateCount, 10000);
// });

// // <!-- fetch('/Get_Ticket_Count/')
// //   .then(response => response.json())
// //   .then(data => console.log(data.count));

// $(document).ready(function() {
//     function updateCount() {
//       // Your code
//     }

//     // Call the function on page load and every 10 seconds
//     updateCount();
//     // setInterval(updateCount, 10000);
//   });

//   $(document).ready(function() {
//     function updateDatas() {
//       $.ajax({
//         url: "{% url 'dashboard_pendings' %}",
//         type: 'GET',
//         dataType: 'json',
//         success: function(data) {
//           // Parse the data from the server and update the table
//           var myData = JSON.parse(data);
//           var t_details = myData.ticket_data.reverse();
//           var tbody = $('#table-datas tbody');
//           var thead = $('#t-head')
//           var counter = 0;

//           tbody.empty();
//           $.each(t_details, function(index, item) {
//             counter++;
//             var row = $('<tr>');
//             row.append($('<td style="color:red;" >').text(item.ticketid));
//               row.append($('<td >').text(item.client));
//             row.append($('<td>').text(item.issue));
//             row.append($('<td>').text(item.doe));
//             // row.append($('<td>').text(item.priority));
//             // row.append($('<td>').text(item.DOExp));
//             row.append($('<td>').append($('<button>').text('View').attr('id', item.ticketid).attr('class', 'view').on('click', function(e) {
//               e.stopPropagation(); // Prevent click event from propagating to parent elements
//               const box = document.getElementById('myBox');
//               const ticketinfo_tag = document.getElementById('ticketinfo');
//               const ticket_id = item.ticketid;
//               const issue_info = item.issue
//               const editUrl = "/user/del_ticket/" + ticket_id + "/";
//               const anchorTag = document.createElement("a");
//               anchorTag.href = editUrl;
//               const editButton = document.createElement("button");
//               editButton.type = "button";
//               editButton.className = "btn edit";
//               editButton.innerText = "Edit";

//               const deleteButton = document.createElement("button");
//               deleteButton.type = "button";
//               deleteButton.className = "btn delete";
//               deleteButton.innerText = "Delete";
//               anchorTag.appendChild(editButton);
//               anchorTag.appendChild(deleteButton);
//               ticketinfo_tag.innerHTML = '<table> <tbody  style="padding: 4px; text-align:left; width:50px; height:100px; overflow:auto ;"><tr><td><b>Ticket ID:</b>' + ticket_id + '</td><tr> \
//                 <tr><td><b>Issue :</b>' + issue_info + '</td><tr> \
//                   <tr><td><b>Issue Descripton :</b>' + item.issuedesc + '</td><tr> \
//                                              </tbody></table><br>';
//               ticketinfo_tag.appendChild(anchorTag);
//               box.style.display = 'block';
//             })));
//             tbody.append(row);
//           });
//           $('#Requests').html(counter);
//           $('#Pending').html(myData.ticket_count.pendings); 
//           console.log('myData:', myData);
// console.log('ticket_count:', myData.ticket_count);
// // console.log('pendings:', myData.ticket_count.pendings);
//         }
//       });
//     }

//     updateDatas();
//     setInterval(updateDatas, 10000);
//     console.log('wokegd');
//   });

//   // Add an event listener to hide the 'myBox' when clicking outside of it
//   $(document).on('click', function(event) {
//     if (!$(event.target).closest('#myBox').length) {
//       var box = document.getElementById("myBox");
//       box.style.display = "none";
//     }
//   });
  

// exit symbol
function closeBox() {

  document.getElementById("tcktpopup").style.display = "none";
}




</script>

{%endblock%}

{%endblock%}
