
{% extends "cAdmin/baseUI.html" %}
{% load static %}
{% block body %}

<style>
  .exit-symbol {
 position: absolute;
 top: 10px;
 right: 24px;
 font-size: 30px;
 cursor: pointer;
}
.reject-button {
      color: white;
      background-color: red;
      padding: 4px;
      border-radius: 5px;
      width:162px;
      border: none;
      cursor: pointer; 
    font-size: 14px; 
    margin-top: 55px;
    
    }
.reject-button:hover {
  background-color: lightcoral; 
}

.action-box {
  background-color: #f3f3f3; /* Off-white shaded background color */
  padding: 15px; /* Adjust padding for spacing */
  display: flex;
  flex-direction: column;
  align-items: left; /* Center horizontally */
  text-align: left; /* Center text horizontally */
  margin: 0 auto; /* Center the box horizontally */
  max-width: 900px; /* Set a maximum width */
  height: 425px; /* Increase the height */
  border-radius: 20px; /* Rounded corners only at the top */
}
#assigndev button {
    color: white;
    background-color: #1aa3ff;
    padding: 4px;
    border-radius: 5px;
    width: 90px;
    border: none;
    cursor: pointer;
    font-size: 14px;   
}



/*....................Remarks..................... box*/
.form__group {
  margin-left: 3px;
  position: relative;
  padding: 20px 0 0;
  width: 100%;
  max-width: 650px;
  margin: 10px;
}

.form__field {
  
  width: 100%;
  border: none;
  border-bottom: 2px solid #9b9b9b;
  outline: 0;
  font-size: 17px;
  color: black;
  padding: 7px 0;
  background: transparent;
  transition: border-color 0.2s;
}

.form__field::placeholder {
  color: transparent;
}

.form__field:placeholder-shown ~ .form__label {
  font-size: 17px;
  cursor: text;
  top: 20px;
}

.form__label {
  position: absolute;
  top: 0;
  display: block;
  transition: 0.2s;
  font-size: 17px;
  color: black;
  pointer-events: none;
}

.form__field:focus {
  padding-bottom: 6px;
  font-weight: 400;
  border-width: 3px;
  border-image: linear-gradient(to right, #116399, #38caef);
  border-image-slice: 1;
}

.form__field:focus ~ .form__label {
  position: absolute;
  top: 0;
  display: block;
  transition: 0.2s;
  font-size: 17px;
  color: black;
  font-weight: 700;
}

/* reset input */
.form__field:required, .form__field:invalid {
  box-shadow: none;
}



.cur_holder {
    color: #ffffff;
    margin-left: -8px;
    border-radius: 15px;
    border: 1px solid white;
    padding: 5px;
    font-size: 0.9rem;  
    border:none;
}

.holder-icon {
    display: inline-block;
    width: 20px;
    height: 20px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24'%3E%3Cpath fill='white' d='M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4Z'/%3E%3C/svg%3E");
    background-size: cover;
    color: #ffffff;
    margin-left: 10px;
    margin-bottom: -5px; 
    font-size: 10px;
    border-radius: 15px;
    border: 1px solid white;
    padding: 5px;
    font-size: 0.8rem;
}


.log {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: #fff;
display: none;
border-radius: 20px;
box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);

width: 1000px;
height: 650px;
z-index: 9992;
}
.log .closeboxlog {
    position:absolute;
    color: #0a0a0a;
    float: right;
    font-size: 30px;
    top: 10px;
    right:45px;
     cursor: pointer;
     z-index: 9993 ;
}
.log .popup-body {

   height: 100%;
   width: 100%;
  overflow-y: auto ;
}


.chat-frame {
position: absolute;
top: 50%;
left: 75%;
 transform: translate(-50%, -50%);
 background-color: transparent; 
display: none;
border-radius: 20px;
 /* box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);  */
width: 400px;
height: 650px;
z-index: 9998;
}
.chat-frame .chat-close{
    display: none;
    position:absolute;
    color: #0a0a0a;
    float: right;
    font-size: 30px;
    top: 30px;
    left:445px;
     cursor: pointer;
     z-index: 9999 ;
}

.btn {
    appearance: none;
      -webkit-appearance: none;
    font-family: sans-serif;
    cursor: pointer;
    padding: 12px;
    min-width: 100px;
    border: 0px;
      -webkit-transition: background-color 100ms linear;
      -ms-transition: background-color 100ms linear;
       transition: background-color 100ms linear;
    float: left;
  }
.edit {
  background: #1181dd;
  margin-right: 60px;
  color: #ffffff;
}
.delete {
  background: #e20b0b;
  
  color: #ffffff;
}
.edit:hover {
  background: #069ff8;
  color: #ffffff;
}
  .view {
  text-decoration: none;
  position: relative;
  border: none;
  font-size: 14px;
  font-family: inherit;
  color: #fff;
  width: 5em;
  height: 2em;
  line-height: 2em;
  text-align: center;
  background: linear-gradient(90deg,#03a9f4,#f441a5,#ffeb3b,#03a9f4);
  background-size: 300%;
  border-radius: 30px;
  z-index: 1;
}

.view:hover {
  animation: ani 8s linear infinite;
  border: none;
}

@keyframes ani {
  0% {
    background-position: 0%;
  }

  100% {
    background-position: 400%;
  }
}

.box {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  display: none;
  border-radius: 20px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  padding-bottom: 25px;
  width: 1000px;
  height: 600px;
  z-index: 9991;
}

   /*css under ticket detaails box:*/

.popup-header {
  background-color: #3c91e6; /* Blue background color */
  color: white; /* White font color */
  text-align: center;
  border-radius: 20px 0 0 0; /* Rounded corners only at the top */
  font-size: 1.3rem;
  padding: 0 5px; /* Remove padding at the top and add padding to the sides */
  height: 110px; /* Adjust the height as needed */
  line-height: 40px; /* Vertically center the content */
  position: sticky;
  top: 0;
}


.popup-header p {
  margin: 0; /* Remove the top and bottom margin for the paragraph */
}

.ticket-id {
  text-align: left;
  font-size: 2rem;
  padding: 15px 25px 0; /* Adjust padding to move content higher */
  margin-top: -10px; /* Add negative margin to move the entire block upwards */
}

.panel-label {
    background-color: white; /* Background color */
    color: black; /* Text color */
    padding: 0px 15px 5px; /* Padding for spacing (adjust the top padding) */
    border-radius: 25px; /* Rounded corners */
    font-size: 24px;
}

.status-label {
    background-color: #3c91e6; /* Background color */
    color: white; /* Text color */
    padding: 5px 15px; /* Padding for spacing */
    border-radius: 25px; /* Rounded corners */
    font-size: 14px;
    margin-top: 20px; /* Add top margin to move it downwards */
    margin-left: 0px; /* Add left margin to move it to the left */
    border: 1px solid white; /* Light and thin white border */
}



.popup-header {
  background-color: #3c5a78; /* Blue background color */
  color: white; /* White font color */
  text-align: center;
  border-radius: 20px 0 0 0; /* Rounded corners only at the top */
  font-size: 1.3rem;
  padding: 0 5px; /* Remove padding at the top and add padding to the sides */
  height: 110px; /* Adjust the height as needed */
  line-height: 40px; /* Vertically center the content */
  position: sticky;
  top: 0;
}


.popup-header p {
  margin: 0; /* Remove the top and bottom margin for the paragraph */
}

.ticket-id {
  text-align: left;
  font-size: 2rem;
  padding: 15px 25px 0; /* Adjust padding to move content higher */
  margin-top: -10px; /* Add negative margin to move the entire block upwards */
}

.panel-label {
    background-color: white; /* Background color */
    color: black; /* Text color */
    padding: 0px 15px 5px; /* Padding for spacing (adjust the top padding) */
    border-radius: 25px; /* Rounded corners */
    font-size: 24px;
}

.status-label {
    background-color: #7863b6; /* Background color */
    color: white; /* Text color */
    padding: 5px 15px; /* Padding for spacing */
    border-radius: 25px; /* Rounded corners */
    font-size: 14px;
    margin-top: 20px; /* Add top margin to move it downwards */
    margin-left: 0px; /* Add left margin to move it to the left */
    border: 1px solid white; /* Light and thin white border */
}



.header-buttons {
  display: flex;
  gap: 10px;
  margin-left: 755px;
  margin-top:-30px /* Adjust the left margin as needed */
                 /* Add top margin to push buttons down slightly */
}
 .header-button {
  background-color: white;
  color: black;
  border: none;
  padding: 5px 10px;
  border-radius: 5px;
  cursor: pointer;
}

.header-button:hover {
  background-color: #3462C2;
} 

.ticket-details-box {
  background-color: #f3f3f3; /* Off-white shaded background color */
  padding: 20px; /* Add padding for spacing */
  display: flex;
  flex-direction: column;
  align-items: left; /* Center horizontally */
  text-align: left; /* Center text horizontally */
  margin: 0 auto; /* Center the box horizontally */
  max-width: 900px; /* Set a maximum width */
}


.ticket-details {
  font-size: 1rem;
  line-height: 2.5;
  display: flex;
  flex-direction: column;
  align-items: flex-start; /* Align content to the top-left */
}

.ticket-details p {
  margin: 0; /* Remove margin for paragraphs inside the ticket-details box */
}

.ticket-details span {
  text-align: center; /* Center the text in the span elements */
}

.gap {
  height: 20px; /* Adjust the height of the gap as needed */
}

.additional-details-box {
  background-color: #f3f3f3; /* Off-white shaded background color */
  border-radius: 20px;
  padding: 25px; /* Add padding for spacing */
  display: flex;
  flex-direction: column;
  align-items: left; /* Center horizontally */
  text-align: left; /* Center text horizontally */
   margin: 0 auto; /* Center the box horizontally */
  max-width: 900px; /* Set a maximum width */
}


.additional-details p {
  margin: 10px 0; /* Add margin for spacing between paragraphs */
}




.view:before {
  content: '';
  position: absolute;
  top: -5px;
  left: -5px;
  right: -5px;
  bottom: -5px;
  z-index: -1;
  background: linear-gradient(90deg,#03a9f4,#f441a5,#ffeb3b,#03a9f4);
  background-size: 400%;
  border-radius: 35px;
  transition: 1s;
}

.view:hover::before {
  filter: blur(20px);
}

.view:active {
  background: linear-gradient(32deg,#03a9f4,#f441a5,#ffeb3b,#03a9f4);
}
  #open {
    display: inline-block;
  border-radius: 20px;
  background-color: #7948d4;
  font-weight: bold;
  color: #ffffff;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  font-size: 16px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

#table-datas {
        border-collapse: collapse; /* This removes the default spacing between table cells */
        width: 100%;
        cursor:pointer;
      
    }

    #table-datas tbody tr {
        border-bottom: 1px solid #dddddd; /* Add a bottom border to tbody rows */
        box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.2); /* Add a small shadow to the bottom of each row */
         border-right: none; /* Hide the right vertical border */
        border-left: none; /* Hide the left vertical border */
    }

    #table-datas th, #table-datas td {
        text-align: left;
        {% comment %} padding: 8px; {% endcomment %}
    }

   .exclude-hover td {
  padding: 10px; /* Adjust the padding as needed */
}


/* Avove div - sort-datas section styless................................................. */
  
  /* Hover for open attachments icon*/
  .bigger-icon {
       transition: transform 0.2s, background-color 0.2s;
      display: inline-block;
    }

    .bigger-icon:hover {
      background-color: 4px solid lightgrey;
      transform: scale(1.1);
      border-radius: 50%;
    }

  /* Hover for chat icon*/
  

    /* Hover for log icon*/
    

  .flex-ticketbox {
            display: flex;
            justify-content: space-around;
            
            
        }
           .flex-item1 {          
            width: 100px;
            height: 50px;
            margin: 1px;
            text-align: left;
            font-size: 16px;
            font-weight:bold;                      
           }

          
        .flex-item2 {
    width: 100px;
    height: 50px;
    margin: 1px;
    text-align: right;
    font-size: 16px;
    margin-left: 150px; 
}


       .flex-item3 {
    width: 400px;
    height: 50px;
    margin: 1px;
    text-align: left;
    font-size: 16px;
    margin-left: 80px; 
}

.custom-p {
        color: #c653c6;
        display: inline;
        /*border: 1px solid purple; 
        padding: 3px 10px 0 10px;
        border-radius: 10px;
        box-shadow: 0 0 5px #7a7aff;*/
      
    }

 .thead-tstrheader {
  background-color: #7863b6;
  color: white;
  padding-left: 17px
  width: 200px; 
  height: 50px;
  text-align: center;
  font-size: 16px;
  border-radius: 10px 10px 0 0;
}

 /*current dev assign label*/ 

.assigned-label {
    display: inline-block;
    background-color: #f4f4f4;
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    color: #262626;
    border: 1px solid #ccc;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
}

.assigned-label span {
    font-weight: normal;
    color:rgb(51, 50, 50);
    margin-right: 5px;
}

#cur_dev_label {
    color: #007bff;
}


    </style>
  
  <!-- <div class="sort-datas">
    <ul class="search_info">
        <li>
            <div id="companyDropdown">
                <span class="company-text">Company</span>
                <select id="companySelect">
                    <option value="">All companies</option>
                    <option value="company1">GMEC</option>
                    <option value="company2">BGEX</option>
                </select>
            </div>
        </li>
        <li>
            <div id="companyDropdown">
                <span class="company-text">Time Period</span>
                <select id="companySelect">
                    <option value="">Current year</option>
                    <option value="company1">Last year</option>
                    <option value="company2">Current Month</option>
                    <option value="company2">Last Month</option>
                    <option value="company2">Current weeks</option>
                </select>
            </div>
        </li>
    </ul>
</div> -->


<ul class="box-info">
    <a href = "{% url 'admin_home' company_id prev_date to_date keyword flag|default:'0' %}" >
	<li>
		<i class='bx bxs-calendar-check' ></i>
		<span class="text">
			<h3 id="Requests">{{inbox}}</h3>
			<p>Inbox</p>
		</span>
	</li></a>
  <a href = "{% url 'admin_inprogress' company_id prev_date to_date keyword flag|default:'0' %}">
	<li style="background-color:  #f0eef7; 	padding: 24px;  border-radius: 20px; display: flex;align-items: center;  grid-gap: 24px;  outline: none;  border-color: #7a7aff;  box-shadow: 0 0 5px #7a7aff;">
		<i class='bx bx-hourglass'></i>
		<span class="text">
			<h3 id="Pending" >{{tickets.count}}</h3>
			<p>In progress</p>
		</span>
	</li></a>

  <a href = "{% url 'admin_forwarded' company_id prev_date to_date keyword flag|default:'0' %}" >
  <li>
		<i class='bx bx-pause-circle'></i>
		<span class="text">
			<h3 id="hold" >{{forwarded}}</h3>
			<p>Forwarded</p>
		</span>
	</li></a>
  <a href = "{% url 'admin_closed' company_id prev_date to_date keyword flag|default:'0' %}" >
	<li><i class='bx bx-window-close'></i>
		<span class="text">
			<h3 id="Closed">{{closed}}</h3>
			<p>Closed</p>
		</span>
	</li></a>
</ul>

<div class="table-data">
  <div class="order">
      <div class="head">
          <h3>Tickets 
             <p  class="custom-p">&nbsp;IN PROGRESS</p>
           </h3>
         
      </div>
       <table id="table-datas">
          <thead class="thead-tstrheader">
              <tr>

                  <td>Ticket ID</td>
                  <td>Requester</td>
                  <td>Client</td>
                  <td>       </td>
                  <td>Subject</td>
                  <td>Allottee</td>
                  <td>Issue Date</td>
                  <td></td>
                  <td></td>
                  <!-- <th>Date Of Expiry</th> -->
                                   
              </tr>
          </thead>
      </div>
      <tbody> 
        {% for ticket in tickets %}
        <tr data-ticket="{{ ticket.ticket_no }}"  id="{{ticket.ticket_no}}" onclick="javascript:showticket('{{ticket.ticket_no}}','{{ticket.maker.username}}');"><td>{{ticket.ticket_no}}</td>
        <td>{{ticket.maker.username}}</td>
        <td>{{ticket.client}}</td>
        {%comment%} <td>{{ticket.maker.company.companyCode}}</td> {%endcomment%} 
        {% if ticket.file.url is not None%}
          <td class="projection">
                    <a href="{{ ticket.file.url }}" target="_blank"> <button class="attachment-icon" title="open files" onclick="event.stopPropagation();" ></button></a>
                    
                    <input type="Hidden" id = 'tfile{{ticket.ticket_no}}' value="{{ticket.file.url}}">
                    </td>

                    {%else %}
                    <td> </td>
                    <input type="Hidden" id = 'tfile{{ticket.ticket_no}}' value="none">
                    {% endif %}
                  
          
          <td>{{ticket.subject}}</td>
          <td id="curhold{{ticket.ticket_no}}" > </td>

        <!-- <td>
          <img src="{% static 'images/chat_icon.png' %}" width="20" height="20" style="margin-left: 10px; margin-top: 10px;" title="Click to open chat">
        </td>
        <td>
       <img src="{% static 'images/log_icon.png' %}" width="25" height="25" style="margin-left: 10px; margin-top: 10px;" title="Click to open log">
        </td> -->
       
           <td style="text-align: left; color: #4d4d4d;">{{ticket.issued_on | date:"d-m-y"}}
        </td>
        <td>
            <div class="chat-container">
                <i  id="chaticon{{ticket.ticket_no}}" class= 'bx bxs-message-alt-dots chat-icon'  title="Open Chat"
                  onclick="document.getElementById('updtid').value='{{ticket.ticket_no}}'; chatfn(); event.stopPropagation();">
                </i>
                {% if ticket.notification %}  <span class="notification-dot"></span> {%endif%}
            </div>
        </td>

        <td>
           <button class="log-icon" title="Open log"  onclick="javascript:document.getElementById('updtid').value='{{ticket.ticket_no}}'; outlook(); event.stopPropagation();"></button>  
        </td>
        <td><input type="Hidden" id = 'tdes{{ticket.ticket_no}}' value="{{ticket.desc}}"></td>
        <td><input type="Hidden" id = 'devassigndte{{ticket.ticket_no}}' value="{{ticket.dev_assigned_date | date:'d-m-Y'}}"></td> 
        <td><input type="Hidden" id = 'testerassigndte{{ticket.ticket_no}}' value="{{ticket.tester_assigned_date | date:'d-m-Y'}}"></td>

        <td><input type="Hidden" id = 'maker{{ticket.ticket_no}}' value="{{ticket.maker.username}}"></td>
        <td><input type="Hidden" id = 'tstatus{{ticket.ticket_no}}' value="{{ticket.status}}"></td>
        {% if ticket.file.url is not None%}
        <td><input type="Hidden" id = 'tfile{{ticket.ticket_no}}' value="{{ticket.file.url}}"></td>
        {%else%}
        <td><input type="Hidden" id = 'tfile{{ticket.ticket_no}}' value="none"></td>
        {%endif%}
        <td><input type="Hidden" id = 'tsub{{ticket.ticket_no}}' value="{{ticket.subject}}"></td>
        {% if ticket.tester_id  is not None%}
        <td><input type="hidden" id = 'ttester{{ticket.ticket_no}}' value="{{ticket.tester_id}}"></td>
        {% else %}
        <td><input type="hidden" id = 'ttester{{ticket.ticket_no}}' value=''></td>
        {% endif %}
        <td><input type="Hidden" id = 'tassigned{{ticket.ticket_no}}' value="{{ticket.dev_id}}"></td>
        <td><input type="Hidden" id = 'tissued{{ticket.ticket_no}}' value="{{ticket.issued_on | date:'d-m-Y'}}"></td>
        <td><input type="Hidden" id = 'tpriority{{ticket.ticket_no}}' value="{{ticket.priority}}"></td>
        <td><input type="Hidden" id = 'tcli{{ticket.ticket_no}}' value="{{ticket.client}}"></td>
        <td><input type="hidden" id = 'tremarks{{ticket.ticket_no}}' value="{{ticket.remarks}}"></td>
        <td><input type="hidden" id = 'tdevs' value="{{devs.client}}"></td>
        <input type="Hidden" id = 'tmaker{{ticket.ticket_no}}' value="{{ticket.maker.username}}">
        <input type="Hidden" id = 'tdevs{{ticket.ticket_no}}' value="{{ticket.dev_id  }}">
        <input type="Hidden" id = 'tgt{{ticket.ticket_no}}' value="{{ticket.tgt_days  }}"> 
         <td><input type="Hidden" id = 'texp{{ticket.ticket_no}}' value="{{ticket.expiry}}">

        {%empty%}
          <td style="text-align: center; color: red;">NO ENTRIES!</td>
          
      {% endfor %}
      <input type="Hidden" id = 'updtid' value=""> 
      <input type="hidden" id="page_id" value="I">

    </tr>
  </tbody>
</table>
</div>
 
      <div class="box" name="myBox" id="myBox" >
        <span class="exit-symbol" onclick="closeBox()">&times;</span>
         <p style="color:rgb(63, 109, 238);"><b><u>Ticket Details</u></b></p>
         <table>
         <hr>
          <body>
              <tr>
                <td id="ticket_no"></td></tr>
                <tr><td id="maker"></td></tr>
                <tr><td id="tsub"></td></tr>
                <tr><td>Description :</td><td><textarea id="tdesc" rows="5" cols="80" ></textarea></td></tr>
                <tr><td id="tpri"></td></tr>
                <tr><td id="tcli"></td></tr>
              </body></table>
       

      


        </div>
      </table>
    </div>

      <!--TICKET DETAILS BOX-------------------->   

    <div class="box" name="tcktpopupview" id="tcktpopupview" style="overflow-y: auto;">
      <div>
          <div class="popup-header">
          <!-- <span class="panel-label">InPROGRESS</span>  -->

        <span class="exit-symbol" onclick="closeBox();">&times;</span>

          <div class="ticket-id">Ticket <span id="ticket_noview"></span>   
          <div ><span class="status-label" id="wrdstat"></span>
          <span class="holder-icon"></span>
          <span id = 'cur_holder' class="cur_holder"></span></span></div>
             
        <div class="header-buttons">
                <button class="header-button" onclick="javascript: chatfn(); ">Chat</button>
                <button class="header-button" onclick="javascript: outlook(); ">Outlook</button>
         </div>
        </div>  
      </div>


              <body>
                  <br>
                
                <div class="ticket-details-box">
                  <div class="ticket-details">

                    <div class="flex-ticketbox" >
                                <div class="flex-item1">Maker</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="tmakerview"></span></div>
                                 
                         </div>

                         <div class="flex-ticketbox">
                                <div class="flex-item1">Priority</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="tpriview"></span></div>
                                 
                         </div>
                         <div class="flex-ticketbox">
                                <div class="flex-item1">Client</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="tcliview"></span></div>
                                 
                         </div>
                         <div class="flex-ticketbox">
                                <div class="flex-item1">Issue Date</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="tissuedview"></span></div>
                                 
                         </div>
                          <div class="flex-ticketbox">
                                <div class="flex-item1">Status</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="tstat"></span></div>
                                 
                         </div>
                          <div class="flex-ticketbox">
                                <div class="flex-item1">Developer&nbsp;Assigned</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="tassignedview"></span></div>
                                 
                         </div>
                          <div class="flex-ticketbox" >
                                <div class="flex-item1" id = 'tester-field'>Tester&nbsp;Assigned</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3"><span id="ttesterview"></span></div>
                                 
                         </div>
                        <div class="flex-ticketbox">
                                <div class="flex-item1">Target date</div>
                                <div class="flex-item2">:</div>
                                <div class="flex-item3" style="color: red;"><span id="target_days"></span></div>
                                 
                         </div>

                  </div>
              </div>
                       
                       <!--  gap -->
              <div class="gap"></div>
                

                <div class="additional-details-box">
                  <div class="additional-details">
                      <p><b>Subject :</b></p>
                      <p><a id="tsubview"></a></p>
                      <p><b>File :</b></p>
                      <p><a id="tfileview" ></a></p>
                      <p><b>Description :</b></p>
                      <textarea input type="text" disabled id="tdescview" rows="6" cols="100"
                          style="border: none; color: #342E37; font-family: poppins, sans-serif; font-size: 16px;"></textarea>
                      <p><b>Remarks :</b></p>
                      <p><a id="tremarksview"></a></p>    
                  </div>
               </div>
               
                     <!--  gap -->
              <div class="gap"></div>
             </body>
            </table>         
         </div>


         <div class="action-box" id = 'action-box'>
                   
                      

                          <br>
                    <div id = 'devasgn' name = 'devasgn' class="child"> <!-- For assign a developer for ticket For : TP -->
                    
                    <form name="devasgn_form" id="devasgn_form" action="{% url 'assignTicket' %}" onsubmit="javascript: return assigndev();" method="post" enctype="multipart/form-data">      
                      {% csrf_token %}
      <input type="hidden" id="page_id" name="page_id" value="I">

                    <table>
                      <div class="form__group field">
                        <input type="input"  id="remarks" name="remarks" class="form__field" placeholder="Name">
                        <label for="name" class="form__label">Comments...</label>
                </div><br>

                
                
             <br>

                      <div class="assigned-label">
                          <span>Currently Assigned Developer : </span>
                          <b id="cur_dev_label"></b>
                      </div>


                    <br><br>
                    <tr ><td><b>Reassign developer &nbsp; : &nbsp; </b></td>
                    
                      <td><select  id="devassign"  name="devassign" value="{{devs}}" style="width:150px; height:30px; border-radius:10px;" placeholder= "select" required>
                        <option selected value="">------Select----------</option>
                            {%  for dev in devs|dictsort:"username" %}
                                <option value={{dev.username}} id ={{dev.id}}> {{dev.username}}</option>
                            {% endfor %}
                            </select>
                      </td>
                      
                  </tr>

                      <tr ><td id="assigndev"><button  class="rejects">Reassign</button></td></tr>
                      
                      
                      </table>
                    </form>
                  </div>
                  <span>
           <button type="button" class="reject-button" onclick="reject();">Reject or Close Ticket</button> 
        </span>
    
         </div>

         
    </div>       
             
        
 
    <div id = 'logframe' class = "log">

      <header><span  id="closeButton" class="closeboxlog" onclick="javascript:document.getElementById('logframe').style.display='none';"><img src="{% static '/images/back-btn-arrw.png' %}"></span>
        </header>
        <div class="popup-body" >
          <iframe id="frame1" style="display: none ;" name="frame1" class="log" scrolling ='yes'   width="50%" height="100%" frameborder="0">
          </iframe>
      </div>
      </div>


      <div id = 'chat-div'  class="chat-frame" >
        <header><span  id="close-chat" class="chat-close"  onclick="javascript:document.getElementById('chat-div').style.display='none';document.getElementById('close-chat').style.display='none';"><img src="{% static '/images/back-btn-arrw.png' %}"></span>
         </header>
       
        <iframe id="chat"   src="" name="chat" class="chat-frame"  width="50%" height="100%"   scrolling="no"  frameborder="0">
               </iframe>  
       
       </div>

{% if messages %}
    {% for message in messages %}
        <script>
            alert("{{ message }}"); 
        </script>

    {% endfor %}
   
{% endif %}

{% block script %}


{% for ticket in tickets %}
  <script>
    
    
    var ticketNo = cur_holder('{{ticket.ticket_no}}');
    document.getElementById('curhold{{ticket.ticket_no}}').innerHTML = ticketNo ;

  </script>
{% endfor %}
<script>

document.getElementById('dashboard').classList.add('active');

// function devslction(tid){
//   // alert(tid+'-tester')
//   var dropdown = document.getElementById('devassign');
//   for (var i = 0; i < dropdown.options.length; i++) {
//             if (dropdown.options[i].value === tid) {
//                 dropdown.options[i].selected = true;
//                 break; // Exit the loop once the desired option is found
//             }
//         }
// }




  function showticket(tno){
      document.getElementById("tcktpopupview").style.display = "block";
      var tdesc = 'tdes'+ tno;
      var tsub = 'tsub'+tno; // subject
      var tpriority = 'tpriority'+tno; //priority
      var tcl = 'tcli' + tno; //Client
      var tfile = 'tfile' + tno;
      var ttester =  'ttester' + tno;
      var texp = "texp" + tno;
      var tester_assigned_date = 'testerassigndte' + tno;
      var tester_assigned_date_value = document.getElementById(tester_assigned_date).value;
      var developer_assigned_date = 'devassigndte' + tno;
      var developer_assigned_date_value = document.getElementById(developer_assigned_date).value;
      var texp_date = document.getElementById(texp).value
      document.getElementById('action-box').style.display = 'none';
      var tester = document.getElementById(ttester).value;
      // alert(tester)
      var tremarks =  document.getElementById('tremarks' + tno).value; if (tremarks == 'None') { tremarks='';}
      var tstat = document.getElementById('tstatus' + tno).value;
      var maker = document.getElementById('maker'+ tno).value;
      var tissued = document.getElementById('tissued' + tno).value;
      var fileurl = document.getElementById(tfile).value;
              // alert(document.getElementById(tdesc).value);
              if(fileurl != 'none'){
                var fileurl = document.getElementById(tfile).value;
                var link =document.createElement('a'); 
                link.href = fileurl;
                link.target = '_blank';
                link.textContent = ' Click here to view file';
                // alert(link);
                document.getElementById('tfileview').appendChild(link);
                }
              else{
                document.getElementById('tfileview').innerHTML = ' No Files Attached.';
              }
      var stat_msg = null;
      if (tstat === 'TA') {
        stat_msg = 'Forwarded\u00A0to\u00A0Developer.';
        document.getElementById('action-box').style.display = 'block';
      }
      else if(tstat == 'DA'){
        stat_msg = 'Developer\u00A0accepted.';
        document.getElementById('action-box').style.display = 'block';
      }
      else if(tstat == 'EP'){
        stat_msg = 'Forwarded\u00A0to\u00A0tester.';
      }
      else if( tstat == 'EA'){
        stat_msg = 'Tester\u00A0accepted.';
      }
      else if( tstat == 'RL' ){
        stat_msg = 'Copy\u00A0procedure\u00A0moved.'
      }
      else if( tstat == 'RA'){
        stat_msg = 'Developer\u00A0accepted\u00A0copy.'
      }
      else if(tstat == 'CD'){
        stat_msg = 'Developer\u00A0has\u00A0closed\u00A0Qry/Bug.';
      }
      else if(tstat == 'BP'){
        stat_msg ='Tester\u00A0has\u00A0reported\u00A0a\u00A0bug.'
      }

      document.getElementById('updtid').value = tno; // This variable will get the current selected ticket id
      document.getElementById('ticket_noview').innerHTML=""+ tno; // ticket number
      // document.getElementById('maker').innerHTML="Maker: "+ user; // user name
      document.getElementById('tmakerview').innerHTML = "" + maker;
      document.getElementById('wrdstat').innerHTML = "STATUS : " + stat_msg;
      document.getElementById('tstat').innerHTML = "" + stat_msg;
      document.getElementById('tsubview').innerHTML="" + document.getElementById(tsub).value; // ticket subject
      document.getElementById('tassignedview').innerHTML="" + document.getElementById('tassigned' + tno ).value + ' [ ' + developer_assigned_date_value + ' ]' ;
      document.getElementById('tdescview').innerHTML="" + document.getElementById(tdesc).value; // ticket description
      document.getElementById('tpriview').innerHTML="" + priority(tno); // ticket priority
      document.getElementById('tcliview').innerHTML='' + document.getElementById(tcl).value; // ticket client
      document.getElementById('tissuedview').innerHTML='' + tissued;
      document.getElementById('tremarksview').innerHTML='' + tremarks;
      document.getElementById('target_days').innerHTML = texp_date ;

      
      if ( tester !=  null && tester!= ''){
      document.getElementById('ttesterview').innerHTML = tester + ' [ ' + tester_assigned_date_value + ' ]' ;
      }

  document.getElementById('cur_holder').innerHTML = cur_holder(tno);
  document.getElementById('cur_dev_label').innerHTML = cur_holder(tno);

      }

      function chatfn(){

    var tid = document.getElementById('updtid').value.trim();
// alert( tid );

    let chatContainer = document.getElementById('chaticon' + tid).parentElement;
    let notificationDot = chatContainer.querySelector('.notification-dot');

    if (notificationDot) {
        notificationDot.remove(); // Removes the span element
    }
document.getElementById('chat').src = "{% url 'chtbx' 0 %}".replace('0', tid);
document.getElementById('chat-div').style.display = 'block';
document.getElementById('close-chat').style.display = 'block';
document.getElementById('chat').style.display = 'block';
}

function reject(){
  tno = document.getElementById('updtid').value.trim();
  
  rjct_reason = document.getElementById('remarks');
  // alert(rjct_reason.value + "j test")
  if(rjct_reason.value == ''){
    alert('Kindly add a rejection or closingremark in the comment section before proceeding.');
    return false
    // rjct_reason = '~'
    }
																  
  // alert(rjct_reason)

  var cf = confirm("CAUTION : You are about to close this ticket .This can't be undone.");
  if (cf == true){
    const link = '/cadmin/adminclose/'+ tno + '/' + rjct_reason.value + '/';
    window.location.href = link;
  }
  else{
    return false;
  }
}

						  

// exit symbol
function closeBox() {
 var box = document.getElementById("myBox");
  box.style.display = "none";
  document.getElementById('tfileview').innerHTML =null;
  document.getElementById("tcktpopupview").style.display = "none";
}
function outlook() {
    var tid = document.getElementById('updtid').value;
    // alert(tid)
    var logsUrl = '/cadmin/logs/' + tid + '/';
    document.getElementById('frame1').src = logsUrl;
    document.getElementById('logframe').style.display = 'block';
    document.getElementById('frame1').style.display = 'block';
}

//   // Add an event listener to hide the 'myBox' when clicking outside of it
//   $(document).on('click', function(event) {
//     if (!$(event.target).closest('#myBox').length) {
//       var box = document.getElementById("myBox");
//       box.style.display = "none";
//     }
//   });

function assigndev(){
  dev_drpdwn = document.getElementById('devassign').value;
  ticket_id = document.getElementById('updtid').value;
  var form = document.getElementById('devasgn_form');
  var hiddenInput = document.createElement('input');
  hiddenInput.type = 'hidden';
  hiddenInput.name = 'updtid';
  hiddenInput.value = ticket_id;
  
  if (dev_drpdwn != "" ){
    var cf = confirm('Are you sure you want to assign this to ' + dev_drpdwn);
    if (cf == true){
      form.appendChild(hiddenInput);
      return true;
    }
    else{
      return false;
    }
  }
  else{
    alert('Please select a developer!');
    return false;
  }

}

</script>

{%endblock%}

{%endblock%}
