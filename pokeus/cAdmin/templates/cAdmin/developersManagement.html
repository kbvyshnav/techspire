{% extends "cAdmin/baseUI.html" %}
{% load static %}
{% block body %}

<style>

.box {
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 background-color: #fff;
 border-radius: 20px;
 box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
 padding: 20px;
 width: 1000px;
 height: 500px;
}

.exit-symbol {
 position: absolute;
 top: 10px;
 right: 24px;
 font-size: 30px;
 cursor: pointer;
}

  
  .btn:focus, .btn.focus {
    outline: 0;

  }



.view {
  background: #1181dd;
  color: #ffffff;
  padding: 10px;
  
}

.view:hover {
  background: #069ff8;
  color: #ffffff;
}

.users {
  background: #1e7575;
  color: #f5f5f5;
  padding: 10px;
  height: 40px;


}

.users:hover {
  background: #2d5e5e;
  color: #ffffff;
}

.edit {
 background: #1181dd;
 position: fixed;
 top: 30%;
 left : 1.9%;
 color: #ffffff;
 padding: 10px;
  height: 40px;


}

.edit:hover {
 background: #069ff8;
 color: #ffffff;
}
.settings {
  background: #ee0603;
  padding: 10px;
  color: #ffffff;
  height: 40px;
  
}

{% comment %} .settings:hover {
  background: #069ff8;
  color: #ffffff;
} {% endcomment %}

 body 
{
counter-reset: Serial;  
}


tr td:first-child:before
{
counter-increment: Serial;/* Increment the Serial counter */
content:  counter(Serial) " ."; /* Display the counter */
} 

.btn-add-dev{
 text-align: center;
  background: #800080;
  color:white;
  padding: 8px;
  outline:none;
  font-family: poppins, sans-serif;
  cursor:pointer;
  border:none;
  transition: background 0.3s ease;
  box-shadow:3px 3px 3px 1px grey; 
}

.btn-add-dev:hover {
  background: #cc99cc; 
}

.btn.delete {
  border: none;
  background:none;
  margin: auto;
  width: 50%; 
  cursor: pointer;
}
  
.btn.delete img {
  width: 99%; 
  height: auto; 

  margin: 7px auto; 
}


.btn.view {
  text-align: center;
  color: #800080;
  padding: 5px;
  outline: none;
  font-family: 'Poppins', sans-serif; 
  cursor: pointer;
  border: none;
  border-radius: 10px; 
  font-size: 0.9rem; 
  background: #F9F9F9; 
}

.btn.view:hover {
  background: #cc99cc; 
}

 /* Style for the overlay background */
 .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        /* Style for the popup box */
        .popup-box {
            display: none;
            position: fixed;
            padding:25px;
            width: 763px;
            height: 406px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Style for the close button */
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
     
     .btn-edit{
      color:black;
      font-size:15px;
      padding-left:15px;
      padding-right:15px;
      box-shadow:3px 3px 3px 1px grey;
      height:30px;
      text-align:top;
      border:none;
      cursor:pointer;
     }

</style>


<div class="table-data"  style=" vertical-align: baseline;">
    <div class="order">
        <div class="head" >
            <h4 style="color: purple;font-size:1.2rem; ">TEAM</h4>
           
    
            <form method="POST" action="{% url 'add_developer' %}" >
                    {% csrf_token %}
                    <button class="btn-add-dev">Add Developer/Tester</button></form>
                  
        </div>
        
         <table id="table-datas">
            <thead>
                
                <tr>
                    <th>Username</th>
                    <th>Name</th>

                    <th>Role</th>
                    <th>Enable/disable</th>
                    
                    <!-- <th>Date Of Expiry</th>
                    <th>View Ticket</th> -->
                    
                    
                </tr>
                
            </thead>
            <tbody>
            
                {% for lst in devs%}     
                <tr>
                <td style="padding-top: 23px;"> {{lst.username}}</td>
                <td> {{lst.first_name}}&nbsp;{{lst.last_name}}</td>

                {% if lst.role == 'D'%}
                <td> Developer</td>
                {% else %}
                <td> Tester</td>
                {% endif %}
                <td>
                  <input type="checkbox" value='{{lst.username}}' id="is_active_checkbox" {% if lst.is_active %}checked{% endif %} data-item-id="{{ lst.id }}">
              </td>
                <td><button type="submit"  class="btn view" id="{{lst.id}}" onclick="openPopup('{{lst.id}}');">View Details</td>

               {%comment%} <td><button type="submit" class="btn delete" onclick="settings(this.id)" id="{{lst.id}}" title="remove"><img src="{% static 'images/delete-icon.png' %}" alt="delete-logo"></button></td></td>{%endcomment%}
                
               <input type="hidden" id="uname{{lst.id}}" value="{{lst.first_name}} {{lst.last_name}}">
                <input type="hidden" id = "ucontact{{lst.id}}" value="{{lst.contact}}">
                <input type="hidden" id= "uemail{{lst.id}}" value="{{lst.email}}">

                </tr> 
                {% empty %}
                <tr><td><b> No developers added yet!</b><td></tr>

                
                
                
                {% endfor %}            
                <input type="hidden" id = "updtid" value="">

              </div>
              <div class="box" id="myBox" style="display: none;">
              <span class="exit-symbol" onclick="closeBox()">&times;</span>
              <p><b>Other details</b></p>
              <p id="address"></p>
              </div>
            
            

        
      </tbody>
           </table>
           <!-- <div class="overlay" id="overlay"></div> -->
           <div class="popup-box" id="popupBox">
                    
                      <span class="exit-symbol" onclick="closePopup()">&times;</span>
                      <!-- Add your content here -->
                     <p style="color: purple;font-size:1.2rem; "><b>OTHER DETAILS </b></p>
                     <hr><br>
                     
                      <p id="puname"></p><br>
                       <p id="puphone"></p><br>
                        <p id="pumail"></p><br>
                      <br>  
                     <button type="button" class="btn-edit" onclick="javascript: editUser();">Edit</button>
                  
                    </div>

                {%comment%}<button onclick="openPopup()">Open Popup</button>{%endcomment%}
             
          </div>
{% if messages %}
    {% for message in messages %}
        <script>
            alert("{{ message }}");
        </script>
    {% endfor %}
{% endif %}



{% block script %}
<script>
document.getElementById('developersmanagement').classList.add('active');
document.getElementById('main-head').style.display ='none';

const viewButtons = document.querySelectorAll('.view');
const box = document.getElementById('myBox');
const addressElement = document.getElementById('address');

// Add event listeners to each "View Details" button
// viewButtons.forEach((button) => {
//   button.addEventListener('click', (event) => {
//     const address = button.value;
//     const cmpnyId = button.id;
//     const editUrl = "/cadmin/adduser/" + cmpnyId + "/";
//     const anchorTag = document.createElement("a");
//     anchorTag.href = editUrl;
//     // const editButton = document.createElement("button");                               
//     // editButton.type = "button";
//     // editButton.className = "btn edit";
//     // editButton.innerText = "Edit";
//     // anchorTag.appendChild(editButton);
//     addressElement.innerHTML = '<table> <tbody  style="padding: 4px; text-align:left; width:50px; height:100px; overflow:auto ;"></br><b>Address: &nbsp; &nbsp; &nbsp;</b>' + address + ' \
//     </tbody></table>';
//     addressElement.appendChild(anchorTag);
//     box.style.display = 'block';
//   });
// });

function openPopup(uid) {
        // document.getElementById('overlay').style.display = 'block';
        document.getElementById('updtid').value = uid;
        document.getElementById('popupBox').style.display = 'block';
        document.getElementById('puname').innerHTML = '<strong>Name :</strong> ' +  document.getElementById('uname' + uid).value;

        document.getElementById('puphone').innerHTML = '<strong>Phonenumber :</strong> ' +  document.getElementById('ucontact' + uid).value;
        document.getElementById('pumail').innerHTML = '<strong>Email :</strong> ' +  document.getElementById('uemail' + uid).value;
        


    }

    function closePopup() {
        // document.getElementById('overlay').style.display = 'none';
        document.getElementById('popupBox').style.display = 'none';
    }

  function editUser(){
    var user_id = document.getElementById('updtid').value;

      window.location.href = "/cadmin/developerEdit/" + user_id + '/';

  }

document.addEventListener('click', (event) => {
  const isClickInside = box.contains(event.target);
  const isViewButtonClick = Array.from(viewButtons).some((button) => button.contains(event.target));

  if (!isClickInside && !isViewButtonClick) {
    box.style.display = 'none';
  }
});


box.addEventListener('click', (event) => {
  event.stopPropagation();
});


document.addEventListener("DOMContentLoaded", function() {
  const is_active_checkboxes = document.querySelectorAll("[data-item-id]");

  is_active_checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener("change", function() {
      const itemId = this.getAttribute("data-item-id");
      const username = this.getAttribute('value');
      const isChecked = this.checked;

      // Send the data to the server using AJAX
      fetch(`/cadmin/update_is_active/${itemId}/`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}",
        },
        body: JSON.stringify({ is_active: isChecked }),
      })
      .then(response => response.json())
      .then(data => {
        // Optionally, handle the response from the server
        if (isChecked) {
          alert(`Enabled ${username}`);
        } else {
          alert(`Disabled ${username}`);
        }
        console.log(data); 
      })
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error("Error:", error);
      });
    });
  });
});

// exit symbol
function closeBox() {
 var box = document.getElementById("myBox");
 box.style.display = "none";
}

// function redirectToUserView(id) {
//   var url = "/cadmin/usermanagement/" + id + "/";
//   window.location.href = url;
// }

// function settings(id) {
//   var url = "/cadmin/companysettings/" + id + "/";
//   window.location.href = url;
// }



</script>
{% endblock %}
{%endblock%}